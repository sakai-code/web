<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>個人サイト向け 無料ホームページテンプレート tp_simple14</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="ここにサイト説明を入れます">
<meta name="keywords" content="キーワード１,キーワード２,キーワード３,キーワード４,キーワード５">
<link rel="stylesheet" href="style.css">

</head>

<body>

	

	<div id="container">

		<div id="main">

			<section id="new" class="box">
				<h2 id="newinfo_hdr" class="close"><span>Mcro:bitコンソール</span>プログラミング教育用</h2>
				<dl id="newinfo">
					<dt>2021/04/25</dt>
					<dd>テスト用ページ公開。<span class="newicon">NEW</span></dd>
					

				</dl>
			</section>

			<section class="box" id="console" padding:2 height:600px>
                
				<p>接続待機中です</p>



			</section>
            <input type="text" name="consoleinput" id="inputform"size="30"maxlength="20" >
            <button id="input">送信する</button>

		</div>
		<!--/main-->

		<div id="sub">

			<!--PC用（801px以上端末）ロゴ-->
			<!--PC用（801px以上端末）メニュー-->
			<nav id="menubar">
				<ul>
					<li><button id="connect" class="button">Micro:bitと接続する</button></li>
					<li><button id="disconnect" class="button">Micro:bitと接続を終了</button></li>
					<li><button id="send" class="button">文字を送信する</button></li>
					<li><button id="clear" class="button">コンソール画面を消去する。</button></li>

				</ul>
			</nav>

		</div>
		<!--/sub-->

		

		<footer>
			<small>Copyright&copy; <a href="index.html">Sample Web Site</a> All Rights Reserved.</small>
			<span class="pr"><a href="http://template-party.com/" target="_blank">《Web Design:Template-Party》</a></span>
		</footer>

	</div>
	<script src="ubitwebusb.js"></script>

	<script>// Append a line to the console frame
    function consolePrintln(message) {
        var con = document.getElementById("console")
        con.innerHTML += "<br/>"+message
        con.scrollTop = con.scrollHeight
    }

    // List of connected devices (a single value could be used if only connecting to one device)
    var connectedDevices = []

    // Example event call-back handler
    function uBitEventHandler(reason, device, data) {
        switch(reason) {
            case "connected":
                consolePrintln("<b>Connected!</b>")
                connectedDevices.push(device)
                break
            case "disconnected":
                consolePrintln("<b>Disconnected</b>")
                connectedDevices = connectedDevices.filter( v => v != device)
                break
            case "connection failure":
                consolePrintln("<b>Connection Failure</b>")
                break
            case "error":
                consolePrintln("<b>Error</b>")
                break
            case "console":
                consolePrintln("Console Data: " + data.data)
                break
            case "graph-event":
                consolePrintln(`Graph Event:  ${data.data} (for ${data.graph}${data.series.length?" / series "+data.series:""})`)
                break
            case "graph-data":
                consolePrintln(`Graph Data: ${data.data} (for ${data.graph}${data.series.length?" / series "+data.series:""})`)
                break
        }
    }

    // Make the "go" button open the request devices box
    document.getElementById("connect").addEventListener("click", () => uBitConnectDevice(uBitEventHandler))
    document.getElementById("disconnect").addEventListener("click", () => connectedDevices.forEach(d=>uBitDisconnect(d)))
    document.getElementById("clear").addEventListener("click", () => { document.getElementById("console").innerHTML = "" })
        document.getElementById("send").addEventListener("click", () => { connectedDevices.forEach(d => uBitSend(d, "Test")) })
        var text = ""
        document.getElementById("input").addEventListener("click", () => {
            text = document.getElementById("inputform").value;
            connectedDevices.forEach(d => uBitSend(d, text));
            document.getElementById("inputform").value = "";

        })</script>

</body>
</html>
